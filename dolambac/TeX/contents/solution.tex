\section{Problemin \c{C}\"{o}z\"{u}m\"{u}}
\label{sec:solution}

Ba\c{s}lang{\i}\c{c} olarak problemin \c{c}\"{o}z\"{u}m\"{u}nde bize
yard{\i}mc{\i} olacak bir teoremi olas{\i}l{\i}k teorisinden \"{o}d\"{u}n\c{c}
alal{\i}m. Bu teorem literat\"{u}rde toplam beklenen de\u{g}er kural{\i} ya da
olas{\i}l{\i}k teorisinin kule kural{\i} olarak
ge\c{c}er~\cite{bertsekas2002introduction}.

\begin{thm}[Kule kural{\i}] \label{thm:kule}
    $X$ bir rastgele de\u{g}i\c{s}ken ve $\{A_i\}_i^m$ \"{o}rneklem
    uzay{\i}n{\i}n sonlu bir b\"{o}l\"{u}mlemesi olsun. O zaman, 
    \[ \mathbb{E}[X] = \sum_i^m \mathbb{E}\left[ X \mid A_i \right]
    \mathbb{P}(A_i). \]
\end{thm}
%
\noindent Bu teoremde $\mathbb{E}$ beklenen de\u{g}eri, $\mathbb{P}$
olas{\i}l{\i}k fonksiyonunu, \"{o}rneklem uzay{\i} terimi ise se\c{c}imlerin
yap{\i}ld{\i}\u{g}{\i} k\"{u}meyi temsil etmektedir. $A_i$ olay{\i}n{\i}n
do\u{g}rulu\u{g}u bilindi\u{g}i takdirde $X$'in beklenen de\u{g}erine
\textit{ko\c{s}ullu beklenen de\u{g}er} denir ve $\mathbb{E}\left[ X \mid A_i
\right]$ sembol\"{u} ile temsil edilir.

Biz problemimizde $k$'inci ad{\i}mda bulundu\u{g}umuz kareyi $s_k$, gitmek
istedi\u{g}imiz kareyi de $g$ olarak adland{\i}ral{\i}m. Rastgele
de\u{g}i\c{s}ken olarak da \c{s}u fonksiyon ailesini alal{\i}m.
\begin{equation}
    C_n := \sum_{k=n+1}^\infty r_k, \qquad r_k = 
\begin{cases}
    1 & \mbox{e\u{g}er } s_k \neq g \\
    0 & \mbox{e\u{g}er } s_k = g
\end{cases}.
\label{eq:RVs}
\end{equation}
Bu denklemdeki toplam{\i}n iyi tan{\i}ml{\i} oldu\u{g}una kendimizi
inand{\i}rmak i\c{c}in $g$ karesine geldikten sonra b\"{u}t\"{u}n $r_k$'lerin
s{\i}f{\i}r de\u{g}erini ald{\i}\u{g}{\i}n{\i} g\"{o}zlemlememiz yeterli
olacakt{\i}r. Bize sorulan $\mathbb{E}[C_0]$ niceli\u{g}inin ka\c{c}
oldu\u{g}udur. \eqref{eq:RVs} denkleminden \c{c}{\i}kar{\i}lacak \c{s}u sonucu
a\c{s}a\u{g}{\i}da \c{c}ok\c{c}a kullanaca\u{g}{\i}z.
% \vspace{-2mm}
\begin{equation*} 
    C_m = \sum_{i=m+1}^n r_i + C_n, \qquad m \leq n.
\end{equation*}
% \vspace{-3mm}
Beklenen de\u{g}erin \"{o}zelliklerini kullanarak a\c{s}a\u{g}{\i}daki sonuca
varabiliriz.
% \vspace{-1mm}
\begin{equation*} 
    \mathbb{E}[C_m] = \sum_{i=m+1}^n \mathbb{E}[r_i] + \mathbb{E}[C_n] = n-m + \mathbb{E}[C_n],
    % \begin{cases}
    %     k + \mathbb{E}[C_n] & \mbox{e\u{g}er } s_i \neq g \\
    %     \mathbb{E}[C_n] & \mbox{e\u{g}er } s_i = g
    % \end{cases}, 
    \qquad m < i < n, \;\; s_i \neq g.
\end{equation*}
% \vspace{-2mm} 
Yukar{\i}daki \"{o}zde\c{s}liklerin benzerleri elbette ko\c{s}ullu beklenen
de\u{g}erler i\c{c}in de ge\c{c}erlidir. Kule kural{\i}n{\i}~\ref{thm:kule}
kullanarak hesaplamaya ba\c{s}layal{\i}m.
%
\vspace{-0mm}
\begin{align}
    \begin{split}
    \mathbb{E}[C_0] = \mathbb{E}\left[ C_0 \mid s_1 \in \{C4, D3\} \right] 
    \underbrace{\mathbb{P}(s_1 \in \{C4, D3\})}_{=\frac{1}{2}} +
    \mathbb{E}\left[ C_0 \mid s_1 \in \{B3, C2\} 
    \right] \underbrace{\mathbb{P}(s_1 \in \{B3, C2\})}_{=\frac{1}{2}}.
    \end{split}
    \label{eq:tower1}
\end{align}
%
% %
% \begin{align}
%     \begin{split}
%     \mathbb{E}[C_0] &= \mathbb{E}\left[ C_0 \mid s_1 \in \{C4, D3\} \right] 
%     \mathbb{P}(s_1 \in \{C4, D3\}) \\ &\hspace{5mm}+ 
%     \mathbb{E}\left[ C_0 \mid s_1 \in \{B3, C2\} \right] \mathbb{P}(s_1 \in \{B3, C2\}) \\
%     &= \frac{1}{2} \mathbb{E}\left[ C_0 \mid s_1 \in \{C4, D3\} \right] 
%     + \frac{1}{2}\mathbb{E}\left[ C_0 \mid s_1 \in \{B3, C2\} \right]
%     \end{split}
%     \label{eq:tower1}
% \end{align}
% %
\hphantom{aha} \\[-2ex]
\c{S}imdi, ilk durumda $s_1 = C4$ oldu\u{g}unu, ikinci durumda da $s_1 = C2$
oldu\u{g}unu var sayaca\u{g}{\i}z. Problemdeki simetri sayesinde $s_1 = D3$
durumunun $s_1 = C4$ durumu ile $s_1 = B3$ durumunun ise $s_1 = C2$ durumu ile
ayn{\i} sonucu verece\u{g}i barizdir. 

\vspace{-3mm}
\paragraph{$\mathbb{E}\left[ C_0 \mid s_1 = C4 \right]$ teriminin
hesaplanmas{\i}.} \"{O}nce~\eqref{eq:tower1} denkleminin sa\u{g} taraf{\i}ndaki
ilk beklenen de\u{g}er terimini ele alaca\u{g}{\i}z. Kule kural{\i}n{\i}
kullanarak hesaplamalar{\i}m{\i}za devam edece\u{g}iz. 

\vspace{-8mm}
\begin{align}
    \begin{split}
    \mathbb{E}\left[ C_0 \mid s_1 = C4 \right] &= \overbrace{r_1 + r_2}^{=2} 
    + \overbrace{\mathbb{E}[C_2 \mid s_1 = C4, s_3 = D5]}^{=2} \overbrace{\mathbb{P}(s_3 = D5 \mid s_1 = C4)}^{=\frac{1}{3}} \\
    &+ \mathbb{E}[C_2 \mid s_1 = s_3 = C4] \underbrace{\mathbb{P}(s_3 = C4 \mid s_1 = C4)}_{=\frac{1}{3}} \\
    &+ \mathbb{E}[C_2 \mid s_1 = C4, s_3 = B5] \underbrace{\mathbb{P}(s_3 = B5 \mid s_1 = C4)}_{=\frac{1}{3}}.
    \end{split}
    \label{eq:tower2}
\end{align}
%
\hphantom{aha} \\[-3ex]
Bu denklemi yazarken \c{s}u g\"{o}zlemlerde bulunduk. E\u{g}er $s_1 = C4$ ise, o
zaman amac{\i}m{\i}za giden yolda iyi bir hamle yapm{\i}\c{s} bulunuyoruz.
Dolay{\i}s{\i}yla, bu hamleyi bir kere daha tekrarl{\i}yoruz ve kendimizi $s_2 =
C5$ karesinde buluyoruz. Bu hamleleri yaparken $2$ tu\c{s}a basmam{\i}z gerekti:
$r_1 + r_2 = 2$.

\c{S}imdi, \eqref{eq:tower2}'\"{u}nc\"{u} denklemin sa\u{g} taraf{\i}ndaki
beklenen de\u{g}erleri inceleyelim. \.Ilk beklenen de\u{g}erin $2$ oldu\u{g}unu
zaten denklemin \"{u}zerinde belirttik. Bunun nedeni, e\u{g}er
\"u\c{c}\"{u}nc\"{u} hamlede kendimizi $s_3 = D5$ karesinde buluyorsak, demek ki
yukar{\i} ve sa\u{g}a giden tu\c{s}lar{\i} biliyoruz. Sa\u{g}a gitmeye devam
ederek amac{\i}m{\i}za ula\c{s}abiliriz. Sa\u{g}a gitmek i\c{c}in de $2$'inci
hamleden itibaren $2$ kere daha bu tu\c{s}a basmam{\i}z gerekir. Geri kalan iki
beklenen de\u{g}eri bulmak icin kule kural{\i}n{\i} bir kere daha g\"{o}reve
\c{c}a\u{g}{\i}raca\u{g}{\i}z.
%
\begin{align*}
    \begin{split}
    \mathbb{E}[C_2 \mid s_1=s_3=C4] = \underbrace{r_3+r_4}_{=2}
    &+ \underbrace{\mathbb{E}[C_4 \mid s_1=s_3=C4, s_5=D5]}_{=2} \underbrace{\mathbb{P}(s_5=D5 \mid s_1=s_3=C4)}_{=\frac{1}{2}} \\
    &+ \underbrace{\mathbb{E}[C_4 \mid s_1=s_3=C4, s_5=B5]}_{=4} \underbrace{\mathbb{P}(s_5=B5 \mid s_1=s_3=C4)}_{=\frac{1}{2}}.
    \end{split}
\end{align*}
%
Buradaki hesaplamam{\i}z{\i} yaparken \c{s}u durumlar{\i} g\"{o}z \"{o}n\"{u}ne
ald{\i}k. E\u{g}er $3$'\"{u}nc\"{u} hamlede kendimizi $s_3=C4$ karesinde
buluyorsak yukar{\i} ve a\c{s}a\u{g}{\i} nas{\i}l gidildi\u{g}ini biliyoruz
demektir. \"{O}nce yukar{\i} giderek hatam{\i}z{\i} d\"{u}zeltiyoruz: $r_3 + r_4
= 2$. Bir sonraki hamlede sa\u{g}a veya sola gitmemizi sa\u{g}layacak herhangi
bir tu\c{s}a bas{\i}yoruz. E\u{g}er sa\u{g}a gidersek, m\"{u}kemmel,
\c{c}\"{u}nk\"{u} amac{\i}m{\i}za yakla\c{s}t{\i}k. Bu durumda sa\u{g}a gitmeye
devam ederek $4$'\"{u}nc\"{u} hamleden sonra sadece $2$ tu\c{s}a daha basarak
amac{\i}m{\i}za ula\c{s}{\i}r{\i}z. Di\u{g}er durumda amac{\i}m{\i}zdan
uzakla\c{s}{\i}yoruz, ama art{\i}k b\"{u}t\"{u}n tu\c{s}lar{\i}n nas{\i}l
\c{c}al{\i}\c{s}t{\i}\u{g}{\i}n{\i} biliyoruz. Yine sa\u{g}a giderek
$4$'\"{u}nc\"{u} hamleden sonra amac{\i}m{\i}za $4$ hamlede ula\c{s}abiliriz.

\eqref{eq:tower2}'\"{u}n sa\u{g} taraf{\i}nda hesaplamad{\i}\u{g}{\i}m{\i}z bir beklenen de\u{g}er kald{\i}:
%
\begin{align*}
    \begin{split}
    \mathbb{E}[C_2 \mid \; s_1=C4, s_3=B5] =
    &\underbrace{\mathbb{E}[C_2 \mid s_1=C4, s_3=B5, s_4=C5]}_{=4} \underbrace{\mathbb{P}(s_4=C5 \mid s_1=C4, s_3=B5)}_{=\frac{1}{2}} \\
    &+ \underbrace{\mathbb{E}[C_2 \mid s_1=C4, s_3=B5, s_4=B4]}_{=6} \underbrace{\mathbb{P}(s_4=B4 \mid s_1=C4, s_3=B5)}_{=\frac{1}{2}}.
    \end{split}
\end{align*}
%
\hphantom{aha} \\[-3ex]
Bu hesaplamay{\i} yaparkenki g\"{o}zlemlerimiz yukar{\i}dakilerle takriben
ayn{\i}. $3$'\"{u}nc\"{u} hamlede kendimizi $s_3 = B5$ karesinde buluyorsak,
demek ki yukar{\i} ve sola g\"{o}t\"{u}ren tu\c{s}lar{\i} biliyoruz. Geri kalan
tu\c{s}lardan birine bast{\i}\u{g}{\i}m{\i}zda ya sa\u{g}a gidece\u{g}iz (iyi
bir durum) ya da a\c{s}a\u{g}{\i} gidece\u{g}iz (k\"{o}t\"{u} bir durum).
Sa\u{g}a gitti\u{g}imizde $2$'inci hamleden sonra beklenen de\u{g}erimiz $4$,
\c{c}\"{u}nk\"{u} sola ve sa\u{g}a giderken $2$ hamle yapt{\i}k. Bundan sonra
amac{\i}m{\i}za ula\c{s}mak icin $2$ hamle daha yapmam{\i}z gerekiyor. Di\u{g}er
durumda ise $2$'inci hamleden sonra beklenen de\u{g}erimiz $6$;
\c{c}\"{u}nk\"{u} art{\i}k tu\c{s}lar{\i} nas{\i}l kullanaca\u{g}{\i}m{\i}z{\i}
biliyoruz ama amac{\i}m{\i}zdan $4$ hamle uzaktay{\i}z: $2+4 = 6$.

% \c{S}imdi b\"{u}t\"{u}n bu hesaplamalar{\i}m{\i}z{\i}~\eqref{eq:tower1}'inci
% denkleme yerle\c{s}tirdi\u{g}imizde denklemin sa\u{g} taraf{\i}ndaki ilk terimi
% bulabiliriz. 
Yukar{\i}daki hesaplar~\eqref{eq:tower1}'inci denklemin sa\u{g} taraf{\i}ndaki
ilk beklenen de\u{g}eri~\eqref{eq:tower2}'\"{u}nc\"{u} denklemi kullanarak
bulmam{\i}z{\i} sa\u{g}l{\i}yor: \fbox{$\mathbb{E}[C_0 \mid s_1=C4] = 6$}.
% %
% \begin{equation*}
%     \mathbb{E}[C_0 \mid s_1=C4]\mathbb{P}(s_1=C4) = 6 \cdot \frac{1}{2} = 3.
%     % \label{eq:first_term}
% \end{equation*}
% %

\vspace{-3mm}
\paragraph{$\mathbb{E}\left[ C_0 \mid s_1 = C2 \right]$ teriminin
hesaplanmas{\i}.} Benzer \c{s}ekilde~\eqref{eq:tower1}'inci denklemin sa\u{g}
taraf{\i}ndaki ikinci beklenen de\u{g}eri hesaplayal{\i}m. 
% Bu sefer
% hesaplamalar{\i}n do\u{g}ruluklar{\i}na okur kendisini inand{\i}rmal{\i}.
%
\begin{align}
    \begin{split}
    \mathbb{E}\left[ C_0 \mid s_1 = C2 \right] =
    &\underbrace{\mathbb{E}[C_0 \mid s_1 = C2, s_2 = B2]}_{=8} \underbrace{\mathbb{P}(s_2 = B2 \mid s_1 = C2)}_{=\frac{1}{3}} \\
    &+ \mathbb{E}[C_0 \mid s_1=C2, s_2 = C3] \underbrace{\mathbb{P}(s_2 = C3 \mid s_1 = C2)}_{=\frac{1}{3}} \\
    &+ \mathbb{E}[C_0 \mid s_1 = C2, s_2 = D2] \underbrace{\mathbb{P}(s_2 = D2 \mid s_1 = C2)}_{=\frac{1}{3}}.
    \end{split}
    \label{eq:tower3}
\end{align}
%
\hphantom{aha} \\[-1ex]
\eqref{eq:tower3}'\"{u}nc\"{u} denklemin sa\u{g} taraf{\i}nda $8$ olarak
belirlenen ilk beklenen de\u{g}eri inceleyerek ba\c{s}layal{\i}m. E\u{g}er ilk
iki ad{\i}mda $C2$ ve $B2$ karelerini ziyaret etmi\c{s}sek, a\c{s}a\u{g}{\i} ve
sola nas{\i}l gidilece\u{g}ini biliyoruz demektir. Kalan iki tu\c{s}tan herhangi
birine basarak $B5$ ya da $E2$'den birine ula\c{s}{\i}p, sonras{\i}nda
kullanmad{\i}\u{g}{\i}m{\i}z son tu\c{s} ile amac{\i}m{\i}za
ula\c{s}{\i}r{\i}r{\i}z. Bu $2$'inci hamleden sonra $6$ hamle daha alacakt{\i}r.

Bir kere daha kule kural{\i}n{\i} kullanarak geri kalan iki beklenen de\u{g}eri
hesapl{\i}yoruz.
%
\begin{align*}
    \begin{split}
    \mathbb{E}[C_0 \mid \; &s_1=C2, s_2=C3] = \overbrace{r_1 + r_2 + r_3 + r_4}^{=4} \\
    &+ \underbrace{\mathbb{E}[C_4 \mid s_1=C2, s_2=C3, s_5=D5]}_{=2} \underbrace{\mathbb{P}(s_5=D5 \mid s_1=C2, s_2=C3)}_{=\frac{1}{2}} \\
    &+ \underbrace{\mathbb{E}[C_4 \mid s_1=C2, s_2=C3, s_5=B5]}_{=4} \underbrace{\mathbb{P}(s_5=B5 \mid s_1=C2, s_2=C3)}_{=\frac{1}{2}}.
    \end{split}
\end{align*}
%
\hphantom{aha} \\[-2ex]
Burada a\c{s}a\u{g}{\i} ve yukar{\i} giden tu\c{s}lar{\i} ke\c{s}fetmi\c{s}
bulunuyoruz. Bu tu\c{s}lar{\i} kullanarak $C5$ karesine ula\c{s}abiliriz. Bu
noktada rastgele bir tu\c{s} se\c{c}ti\u{g}imizde ya sa\u{g}a ya da sola
gidece\u{g}iz. Sa\u{g}a gidersek bu davran{\i}\c{s}{\i} tekrarlayarak
amac{\i}m{\i}za ula\c{s}{\i}rken, sola gidersek daha
kullanmad{\i}\u{g}{\i}m{\i}z kalan tu\c{s}a basarak amac{\i}m{\i}za
ula\c{s}{\i}r{\i}z. \.{I}lk durumda $4$'\"{u}nc\"{u} ad{\i}mdan sonra $2$ hamle
daha yapmam{\i}z gerekirken, ikinci durumda $4$ hamle daha yapmam{\i}z
gerekiyor.

\eqref{eq:tower3}'\"{u}n sa\u{g} taraf{\i}nda hesaplamad{\i}\u{g}{\i}m{\i}z bir
beklenen de\u{g}er kald{\i}:
%
\vspace{-2mm}
\begin{align*}
    \begin{split}
    \mathbb{E}[C_0 \mid \; &s_1=C2, s_2=D2] = \overbrace{r_1 + r_2 + r_3}^{=3} \\
    &+ \underbrace{\mathbb{E}[C_3 \mid s_1=C2, s_2=D2, s_4=E3]}_{=3} \underbrace{\mathbb{P}(s_4=E3 \mid s_1=C2, s_2=D2)}_{=\frac{1}{2}} \\
    &+ \underbrace{\mathbb{E}[C_3 \mid s_1=C2, s_2=s_4=D2]}_{=5} \underbrace{\mathbb{P}(s_4=D2 \mid s_1=C2, s_2=D2)}_{=\frac{1}{2}}.
    \end{split}
\end{align*}
%
\hphantom{aha} \\[-2ex]
Bu sefer a\c{s}a\u{g}{\i} ve sa\u{g}a giden tu\c{s}lar{\i} ke\c{s}fetmi\c{s}
durumday{\i}z. Sa\u{g}a bir kere daha giderek amac{\i}m{\i}za yakla\c{s}abiliriz
ve bu noktada $3$ hamle yapm{\i}\c{s} oluruz. Bir sonraki hamlede kalan
tu\c{s}lardan birini kullanarak ya $E3$'e ya da $D2$'ye gidece\u{g}iz. $E3$'e
gidersek, bu tu\c{s}u kullanmaya devam ederek amac{\i}m{\i}za
ula\c{s}{\i}r{\i}z. Bu durumda $3$'\"{u}nc\"{u} hamleden sonra $3$ hamle
yapm{\i}\c{s} oluyoruz. E\u{g}er kendimizi $D2$'de bulursak, art{\i}k
b\"{u}t\"{u}n tu\c{s}lar{\i}n nas{\i}l \c{c}al{\i}\c{s}t{\i}\u{g}{\i}n{\i}
biliyoruz ve amac{\i}m{\i}zdan $4$ kare uzaktay{\i}z; yani $3$'\"{u}nc\"{u}
hamleden sonra $5$ hamleye daha yapmaya ihtiyac{\i}m{\i}z var.

Art{\i}k \eqref{eq:tower1}'inci denklemin sa\u{g} taraf{\i}ndaki ikinci beklenen
de\u{g}eri hesaplamak i\c{c}in~\eqref{eq:tower3}'\"{u} kullabiliriz:
\fbox{$\mathbb{E}[C_0 \mid s_1=C2] = \frac{22}{3}$}.
% %
% \begin{equation*}
%     \mathbb{E}[C_0 \mid s_1=C2]\mathbb{P}(s_1=C2) = \frac{22}{3} \cdot \frac{1}{2} = \frac{11}{3}.
%     \label{eq:second_term}
% \end{equation*}
% %
Arad{\i}\u{g}{\i}m{\i}z her niceli\u{g}i hesaplad{\i}k. \eqref{eq:tower1}'inci
denkleme geri d\"{o}nelim:
% \[
% \boxed{
%     \mathbb{E}[C_0] = \underbrace{\mathbb{E}\left[ C_1 \mid s_1 \in \{C4, D3\} \right]}_{=6} 
%     \underbrace{\mathbb{P}(s_1 \in \{C4, D3\})}_{=\frac{1}{2}} + \\ 
%     % \underbrace{\mathbb{E}\left[ C_1 \mid s_1 \in \{B3, C2\}}_{=7}
%     % \right] 
%     \underbrace{\mathbb{P}(s_1 \in \{B3, C2\})}_{=\frac{1}{2}}.
% }
% \]
%
% \fbox{
\begin{empheq}[box=\widefbox]{align}
    \begin{split}
    \mathbb{E}[C_0] = &\underbrace{\mathbb{E}\left[ C_0 \mid s_1 \in \{C4, D3\} \right]}_{=6}
    \underbrace{\mathbb{P}(s_1 \in \{C4, D3\})}_{=\frac{1}{2}}\\ 
    &+ \underbrace{\mathbb{E}\left[ C_0 \mid s_1 \in \{B3, C2\} \right]}_{=\frac{22}{3}} 
    \underbrace{\mathbb{P}(s_1 \in \{B3, C2\})}_{=\frac{1}{2}} = \frac{20}{3} = 6.\bar{6}.
    \end{split}
    \label{eq:tower}
\end{empheq}
% }
%